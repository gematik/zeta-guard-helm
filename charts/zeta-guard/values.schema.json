{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "properties": {
    "authserver": {
      "type": "object",
      "properties": {
        "admin": {
          "type": "object",
          "properties": {
            "username": { "type": "string", "minLength": 1 },
            "password": { "type": ["string", "null"] }
          }
        }
      }
    },
    "authServerLogConsoleOutput": {
      "type": "string",
      "enum": [
        "default",
        "json"
      ]
    },
    "authServerMetricsEnabled": {
      "type": "boolean"
    },
    "authServerTracingEnabled": {
      "type": "boolean"
    },
    "gematik": {
      "type": "object",
      "properties": {
        "clientId": {
          "type": "string",
          "minLength": 1
        },
        "serviceAccountEmailAddress": {
          "type": "string",
          "minLength": 5
        },
        "workloadIdentityFederation": {
          "type": "object",
          "properties": {
            "projectNumber": {
              "type": "string",
              "minLength": 1
            },
            "poolId": {
              "type": "string",
              "minLength": 1
            },
            "workloadIdentityProvider": {
              "type": "string",
              "minLength": 1
            }
          },
          "required": [
            "projectNumber",
            "poolId",
            "workloadIdentityProvider"
          ]
        }
      },
      "required": [
        "clientId",
        "serviceAccountEmailAddress",
        "workloadIdentityFederation"
      ]
    },
    "gematikConnectionEnabled": {
      "type": "boolean"
    },
    "global": {
      "type": "object",
      "properties": {
        "registry_host": {
          "type": "string"
        }
      },
      "required": [
        "registry_host"
      ]
    },
    "log-collector": {
      "type": "object"
    },
    "logCollectorEnabled": {
      "type": "boolean"
    },
    "opaDistributedTracingEnabled": {
      "type": "boolean"
    },
    "opaStatusPrometheus": {
      "type": "boolean"
    },
    "databaseMode": {
      "type": "string",
      "enum": ["operator", "external", "bitnami"],
      "description": "Where the database credentials are sourced from. If 'operator' then nothing else needs to be done. If 'external', also see value 'authserverDb'."
    },
    "authserverDb": {
      "type": "object",
      "description": "Relevant only for databaseMode=external . This is how you can configure your own DB.",
      "properties": {
        "kcDb": {
          "type": "string",
          "description": "See environment variable KC_DB in keycloak config https://www.keycloak.org/server/db"
        },
        "kcDbUrl": {
          "type": "string",
          "description": "See environment variable KC_DB_URL in keycloak config https://www.keycloak.org/server/db"
        },
        "kcDbUsername": {
          "type": "string",
          "description": "See environment variable KC_DB_USERNAME in keycloak config https://www.keycloak.org/server/db"
        },
        "kcDbPasswordSecretName": {
          "type": "string",
          "description": "Name of a secret that contains the database password in its field 'password'. Will be passed into environment variable KC_DB_PASSWORD. See keycloak config https://www.keycloak.org/server/db"
        },
        "kcDbSchema": {
          "type": "string",
          "description": "See environment variable KC_DB_SCHEMA in keycloak config https://www.keycloak.org/server/db"
        }
      }
    },
    "pepproxy": {
      "type": "object",
      "properties": {
        "nginxConf": {
          "type": "object",
          "properties": {
            "configMapName": {
              "type": "string"
            },
            "fachdienstUrl": {
              "type": "string"
            },
            "fileContent": {
              "type": "string"
            },
            "generateConfigMap": {
              "type": "boolean"
            },
            "httpClientAcceptInvalidCerts": {
              "type": "boolean"
            },
            "aslTestmode": {
              "type": "boolean"
            },
            "locations": {
              "type": "string"
            },
            "pepIssuer": {
              "type": "string"
            },
            "poppIssuer": {
              "type": "string"
            },
            "requiredAudience": {
              "type": "string"
            },
            "requiredScopes": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "configMapName",
            "generateConfigMap",
            "pepIssuer",
            "poppIssuer"
          ],
          "allOf": [
            {
              "if": {
                "properties": {
                  "generateConfigMap": {
                    "const": true
                  }
                }
              },
              "then": {
                "properties": {
                  "fachdienstUrl": {
                    "minLength": 1
                  },
                  "requiredAudience": {
                    "minLength": 1
                  }
                },
                "required": [
                  "fachdienstUrl",
                  "httpClientAcceptInvalidCerts",
                  "locations",
                  "pepIssuer",
                  "requiredAudience",
                  "requiredScopes"
                ]
              }
            }
          ]
        }
      },
      "required": [
        "nginxConf"
      ]
    },
    "pepproxyMetricsEnabled": {
      "type": "boolean"
    },
    "pepproxyTracingEnabled": {
      "type": "boolean"
    },
    "telemetry-gateway": {
      "type": "object"
    },
    "telemetryGatewayEnabled": {
      "type": "boolean"
    },
    "opa": {
      "type": "object",
      "properties": {
        "bundle": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "serviceName": {
              "type": "string"
            },
            "url": {
              "type": "string"
            },
            "resource": {
              "type": "string"
            },
            "polling": {
              "type": "object",
              "properties": {
                "min_delay_seconds": {
                  "type": "integer"
                },
                "max_delay_seconds": {
                  "type": "integer"
                }
              }
            },
            "verification": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean"
                },
                "keyId": {
                  "type": "string"
                },
                "algorithm": {
                  "type": "string"
                },
                "publicKey": {
                  "type": "string"
                }
              }
            },
            "credentials": {
              "type": "object",
              "properties": {
                "secretRef": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "workloadIdentityFederation": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            }
          }
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "workloadIdentityFederation": {
                "type": "object",
                "properties": {
                  "enabled": {
                    "const": true
                  }
                }
              }
            }
          },
          "then": {
            "not": {
              "properties": {
                "bundle": {
                  "type": "object",
                  "properties": {
                    "credentials": {
                      "type": "object",
                      "properties": {
                        "secretRef": {
                          "type": "object",
                          "properties": {
                            "name": {
                              "type": "string",
                              "minLength": 1
                            }
                          },
                          "required": [
                            "name"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "bundle": {
                "type": "object",
                "properties": {
                  "enabled": {
                    "const": true
                  }
                }
              }
            }
          },
          "then": {
            "properties": {
              "bundle": {
                "properties": {
                  "serviceName": {
                    "minLength": 1
                  },
                  "resource": {
                    "minLength": 1
                  }
                },
                "required": [
                  "serviceName",
                  "resource"
                ]
              }
            }
          }
        }
      ]
    }
  },
  "required": [
    "authServerLogConsoleOutput",
    "authServerMetricsEnabled",
    "authServerTracingEnabled",
    "gematikConnectionEnabled",
    "global",
    "logCollectorEnabled",
    "opaDistributedTracingEnabled",
    "opaStatusPrometheus",
    "pepproxy",
    "pepproxyMetricsEnabled",
    "pepproxyTracingEnabled",
    "telemetryGatewayEnabled"
  ],
  "allOf": [
    {
      "if": {
        "properties": {
          "gematikConnectionEnabled": {
            "const": true
          }
        }
      },
      "then": {
        "required": [
          "gematik"
        ]
      }
    }
  ],
  "title": "Values",
  "type": "object"
}
